async function generateScenario() {
  // Add timestamp to URL to force fresh request
  const timestamp = Date.now();
  const randomParam = Math.random();
  
  const res = await fetch(`/api/scenarios?t=${timestamp}&r=${randomParam}`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Cache-Control': 'no-cache',
      'Pragma': 'no-cache'
    },
    body: JSON.stringify({
      entropy: Math.random(),
      timestamp: timestamp
    }),
    cache: 'no-store',
    mode: 'cors',
    credentials: 'same-origin'
  });
  
  const data = await res.json();
  
  // Log debug information
  console.log('=== NEW SCENARIO REQUEST ===');
  console.log('Timestamp:', timestamp);
  console.log('API Response:', data);
  console.log('Debug info:', data.debug);
  console.log('Scenario Title:', data.title);
  console.log('Raw questions:', data.questions);
  
  state.scenario = data.description;
  state.questions = (data.questions || [])
  .filter(q => q && q.department && q.questionText && Array.isArray(q.choices))
  .map(q => ({ ...q, choices: shuffle([...q.choices]) }));

  console.log('Filtered questions:', state.questions);
  console.log('Number of questions:', state.questions.length);

  state.currentIndex = 0;
  document.getElementById('introBox').classList.add('hidden');
  document.getElementById('scenarioBox').classList.remove('hidden');
  document.getElementById('scenarioText').textContent = state.scenario;
  renderScoreboard();
  renderQuestion();
}