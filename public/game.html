<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crisis Management Game</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    header {
      background: #fff;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .logo {
      height: 60px;
    }

    h1 {
      color: #c0392b;
      margin-top: 10px;
    }

    .scoreboard {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 20px auto;
      max-width: 800px;
    }

    .dept-box {
      flex: 1 1 200px;
      margin: 10px;
      padding: 20px;
      color: white;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .dept-box.purple { background: #8e44ad; }
    .dept-box.red { background: #e74c3c; }
    .dept-box.blue { background: #2980b9; }
    .dept-box.green { background: #27ae60; }
    .dept-box.orange { background: #f39c12; }
    .dept-box.violet { background: #9b59b6; }
    .dept-box.teal { background: #1abc9c; }

    .scenario-box, .question-box {
      max-width: 800px;
      background: white;
      margin: 20px auto;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .scenario-box p {
      font-size: 18px;
      line-height: 1.6;
    }

    .question-box h2 {
      font-size: 22px;
    }

    .choice {
      margin: 10px 0;
      font-size: 18px;
    }

    button {
      margin: 20px 5px;
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      background: #2ecc71;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background: #27ae60;
    }
  </style>
</head>
<body>
  <header>
    <img src="/images/bank-logo.png" class="logo" alt="SSBTX Bank Logo" />
    <h1>Crisis Management Game</h1>
    <button onclick="startGame()">Generate New Crisis Scenario</button>
    <button onclick="resetGame()">Reset Game</button>
    <button onclick="window.location.href='/'">Back to Home</button>
  </header>

  <div class="scoreboard" id="scoreboard"></div>
  <div class="scenario-box" id="scenario"></div>
  <div class="question-box" id="question"></div>

  <script>
    const departments = [
      { name: 'CEO/SVPs', color: 'purple' },
      { name: 'IT/Security', color: 'red' },
      { name: 'HR', color: 'blue' },
      { name: 'Finance', color: 'green' },
      { name: 'Loans', color: 'orange' },
      { name: 'Accounting', color: 'violet' },
      { name: 'Deposits', color: 'teal' }
    ];

    let scenarioData = null;
    let currentQuestion = 0;
    let scores = {}, strikes = {}, round = 1;

    function initScoreboard() {
      const board = document.getElementById('scoreboard');
      board.innerHTML = '';
      departments.forEach(dept => {
        scores[dept.name] = 0;
        strikes[dept.name] = 0;
        board.innerHTML += `
          <div class="dept-box ${dept.color}">
            <div><strong>${dept.name}</strong></div>
            <div id="score-${dept.name}">${scores[dept.name]}</div>
            <div>⚠️⚠️⚠️</div>
          </div>`;
      });
    }

    function startGame() {
      fetch('/api/generate-scenario', { method: 'POST' })
        .then(res => res.json())
        .then(data => {
          scenarioData = data;
          currentQuestion = 0;
          document.getElementById('scenario').innerHTML = `<h2>Scenario</h2><p>${data.description}</p>`;
          showQuestion();
        });
    }

    function showQuestion() {
      if (!scenarioData || currentQuestion >= scenarioData.questions.length) {
        document.getElementById('question').innerHTML = `<h2>Game Over!</h2><p>Thanks for playing.</p>`;
        return;
      }

      const q = scenarioData.questions[currentQuestion];
      const dept = departments.find(d => d.name.includes(q.department)) || departments[currentQuestion % 7];
      const color = dept.color;

      document.getElementById('question').style.borderTop = `5px solid ${dept.color}`;
      document.getElementById('question').innerHTML = `
        <h2 style="color:${color}">${q.department} Department</h2>
        <p><strong>${q.questionText}</strong></p>
        ${q.choices.map((choice, i) => `<div class="choice"><input type="radio" name="ans" value="${choice}" id="opt${i}"><label for="opt${i}"> ${choice}</label></div>`).join('')}
        <button onclick="submitAnswer('${q.answer}')">Submit</button>
      `;
    }

    function submitAnswer(correct) {
      const selected = document.querySelector('input[name=ans]:checked');
      if (!selected) return alert('Please select an answer');

      const dept = scenarioData.questions[currentQuestion].department;
      if (selected.value === correct) scores[dept] += 5;
      else strikes[dept] += 1;

      document.getElementById(`score-${dept}`).textContent = scores[dept];

      currentQuestion++;
      showQuestion();
    }

    function resetGame() {
      scenarioData = null;
      currentQuestion = 0;
      round = 1;
      initScoreboard();
      document.getElementById('scenario').innerHTML = '';
      document.getElementById('question').innerHTML = '';
    }

    window.onload = initScoreboard;
  </script>
</body>
</html>
