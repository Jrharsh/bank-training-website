<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crisis Management Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .back-button {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            margin-bottom: 20px;
        }
        
        .back-button:hover {
            background: #7f8c8d;
        }
        
        .department-scores {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .department-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-left: 4px solid;
        }
        
        .department-name {
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
        }
        
        .department-score {
            font-size: 1.8em;
            font-weight: bold;
        }
        
        .scenario-reference {
            background: #ecf0f1;
            padding: 15px 15px 15px 15px; /* Added right padding for button */
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #e74c3c;
            position: relative;
        }
        
        .scenario-toggle {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10; /* Ensure button stays on top */
        }
        
        .scenario-toggle:hover {
            background: #c0392b;
        }
        
        .scenario-content {
            margin-top: 10px;
            padding-right: 80px; /* Add space so text doesn't go under button */
        }
        
        .scenario-content.collapsed {
            display: none;
        }
        
        .scenario-title-area {
            padding-right: 80px; /* Add space for button */
            margin-bottom: 10px;
        }
        
        .scenario-panel {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .scenario-title {
            font-size: 1.4em;
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .scenario-description {
            color: #555;
            line-height: 1.6;
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            text-align: left;
        }
        
        .option-button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .option-button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #e74c3c;
            color: white;
        }
        
        .btn-primary:hover {
            background: #c0392b;
        }
        
        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .btn-next {
            background: #27ae60;
            color: white;
        }
        
        .btn-next:hover {
            background: #229954;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }
        
        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .success {
            background: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        .round-info {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2em;
            color: #2c3e50;
        }
        
        .department-label {
            background: #3498db;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.3em;
            text-align: center;
            margin-bottom: 20px;
            border: 3px solid #2980b9;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        /* ELEGANT STRIKES POPUP STYLES */
        .strikes-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .strikes-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .strikes-popup {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.2),
                0 0 0 1px rgba(255, 255, 255, 0.5);
            transform: scale(0.7) translateY(30px);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
        }

        .strikes-overlay.show .strikes-popup {
            transform: scale(1) translateY(0);
        }

        .strikes-popup::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: linear-gradient(90deg, #e74c3c, #f39c12, #e74c3c);
            background-size: 200% 100%;
            animation: pulse-gradient 2s ease-in-out infinite;
        }

        @keyframes pulse-gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .strikes-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: shake 0.6s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            75% { transform: translateX(10px) rotate(5deg); }
        }

        .strikes-title {
            font-size: 1.8rem;
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .strikes-department {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .strikes-counter {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
        }

        .strike-indicator {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            transition: all 0.3s ease;
            border: 3px solid;
        }

        .strike-indicator.active {
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            color: white;
            border-color: #c0392b;
            animation: strike-pulse 0.6s ease-out;
        }

        .strike-indicator.inactive {
            background: linear-gradient(145deg, #ecf0f1, #d5dbdb);
            color: #95a5a6;
            border-color: #bdc3c7;
        }

        @keyframes strike-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); box-shadow: 0 0 20px rgba(231, 76, 60, 0.5); }
            100% { transform: scale(1); }
        }

        .strikes-message {
            font-size: 1.1rem;
            color: #555;
            line-height: 1.6;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(231, 76, 60, 0.1);
            border-radius: 10px;
            border-left: 4px solid #e74c3c;
        }

        .strikes-warning {
            font-size: 1rem;
            color: #e67e22;
            font-weight: 600;
            margin-bottom: 25px;
            padding: 10px;
            background: rgba(243, 156, 18, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(243, 156, 18, 0.3);
        }

        .strikes-close-btn {
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }

        .strikes-close-btn:hover {
            background: linear-gradient(145deg, #c0392b, #a93226);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }

        .strikes-close-btn:active {
            transform: translateY(0);
        }

        /* Department Eliminated Popup Styles */
        .department-eliminated-popup {
            background: linear-gradient(145deg, #2c3e50, #34495e);
            color: white;
            max-width: 600px;
        }

        .department-eliminated-popup::before {
            background: linear-gradient(90deg, #e74c3c, #8e44ad, #e74c3c);
        }

        .eliminated-image-container {
            margin-bottom: 20px;
            position: relative;
        }

        .eliminated-image {
            width: 200px;
            height: 150px;
            object-fit: cover;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            animation: elimination-shake 1s ease-in-out;
        }

        @keyframes elimination-shake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-5px) rotate(-2deg); }
            75% { transform: translateX(5px) rotate(2deg); }
        }

        .eliminated-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(231, 76, 60, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        .department-eliminated-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            animation: elimination-pulse 1s ease-in-out infinite;
        }

        @keyframes elimination-pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; filter: brightness(1.2); }
        }

        .department-eliminated-title {
            font-size: 2rem;
            color: #e74c3c;
            margin-bottom: 15px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .department-eliminated-message {
            background: rgba(231, 76, 60, 0.2);
            color: #ecf0f1;
            border-color: #e74c3c;
            margin-bottom: 20px;
        }

        .continue-game-message {
            background: rgba(46, 204, 113, 0.2);
            color: #ecf0f1;
            border-color: #27ae60;
            border-left: 4px solid #27ae60;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .scenario-content {
                padding-right: 60px; /* Less padding on mobile */
            }
            
            .scenario-title-area {
                padding-right: 60px;
            }
            
            .scenario-toggle {
                padding: 4px 8px;
                font-size: 0.7em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="back-button" onclick="goHome()">‚Üê Back to Home</button>
        
        <div class="header">
            <h1>üè¶ Crisis Management Game</h1>
            <p style="color: green; font-size: 20px;">‚úÖ 21 Questions Per Scenario - All Departments</p>
            <p>Navigate realistic business scenarios and manage departmental impact</p>
        </div>
        
        <div class="round-info">
            <strong>Round: <span id="roundNumber">1</span></strong>
        </div>
        
        <div class="department-scores" id="departmentScores">
            <!-- Department cards will be populated by JavaScript -->
        </div>
        
        <!-- Always visible scenario reference -->
        <div id="scenarioReference" class="scenario-reference hidden">
            <button class="scenario-toggle" onclick="toggleScenario()">
                <span id="toggleText">Hide Scenario</span>
            </button>
            <div class="scenario-title-area">
                <div style="font-weight: bold; color: #e74c3c; margin-bottom: 10px;">
                    üö® CRISIS SCENARIO: <span id="scenarioTitleRef"></span>
                </div>
            </div>
            <div id="scenarioContentRef" class="scenario-content">
                <!-- Scenario description will be shown here -->
            </div>
        </div>
        
        <div id="scenarioPanel" class="scenario-panel hidden">
            <div id="departmentLabel" class="department-label"></div>
            <div class="scenario-description" id="scenarioDescription"></div>
            <div class="options" id="optionsContainer"></div>
            <div class="action-buttons" style="margin-top: 20px;">
                <button class="btn btn-next" id="nextQuestionBtn" style="display: none;">Next Question</button>
            </div>
        </div>
        
        <div id="loadingPanel" class="loading hidden">
            Generating scenario... ü§ñ
        </div>
        
        <div id="messagePanel" class="hidden"></div>
        
        <div class="action-buttons">
            <button class="btn btn-primary" id="generateBtn">Generate New Crisis</button>
            <button class="btn btn-secondary" id="resetBtn">Reset Game</button>
        </div>
    </div>

    <!-- ELEGANT STRIKES POPUP -->
    <div id="strikesOverlay" class="strikes-overlay">
        <div id="strikesPopup" class="strikes-popup">
            <div id="strikesIcon" class="strikes-icon">‚ùå</div>
            <div id="strikesTitle" class="strikes-title">Critical Error!</div>
            <div id="strikesDepartment" class="strikes-department"></div>
            
            <div class="strikes-counter" id="strikesCounter">
                <!-- Strike indicators will be populated by JavaScript -->
            </div>
            
            <div id="strikesMessage" class="strikes-message"></div>
            <div id="strikesWarning" class="strikes-warning"></div>
            
            <button class="strikes-close-btn" onclick="closeStrikesPopup()">Continue Game</button>
        </div>
    </div>

    <script>
        console.log('Crisis Management Game Loaded');
        
        // Game State
        const departments = {
            'CEO_SVPs': { name: 'CEO/SVPs', score: 0, strikes: 0, color: '#8e44ad' },
            'IT_Security': { name: 'IT/Security', score: 0, strikes: 0, color: '#e74c3c' },
            'HR': { name: 'HR', score: 0, strikes: 0, color: '#3498db' },
            'Finance': { name: 'Finance', score: 0, strikes: 0, color: '#2ecc71' },
            'Loans': { name: 'Loans', score: 0, strikes: 0, color: '#f39c12' },
            'Accounting': { name: 'Accounting', score: 0, strikes: 0, color: '#9b59b6' },
            'Deposits': { name: 'Deposits', score: 0, strikes: 0, color: '#1abc9c' }
        };
        
        let currentRound = 1;
        let currentScenario = null;
        let currentQuestionIndex = 0;
        let scenarioCollapsed = false;
        
        // Navigation
        function goHome() {
            window.location.href = '/';
        }
        
        // Toggle scenario visibility
        function toggleScenario() {
            const content = document.getElementById('scenarioContentRef');
            const toggleText = document.getElementById('toggleText');
            
            scenarioCollapsed = !scenarioCollapsed;
            content.classList.toggle('collapsed', scenarioCollapsed);
            toggleText.textContent = scenarioCollapsed ? 'Show Scenario' : 'Hide Scenario';
        }

        // ELEGANT STRIKES POPUP FUNCTIONS
        function showStrikesPopup(departmentKey, strikeCount, isDepartmentEliminated = false) {
            const dept = departments[departmentKey];
            const overlay = document.getElementById('strikesOverlay');
            const popup = document.getElementById('strikesPopup');
            
            // Configure popup content
            if (isDepartmentEliminated) {
                // Add image container
                document.getElementById('strikesIcon').innerHTML = `
                    <div class="eliminated-image-container">
                        <img src="/images/eliminated.png" alt="Department Eliminated" class="eliminated-image" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <div class="department-eliminated-icon" style="display: none;">üíÄ</div>
                        <div class="eliminated-overlay">ELIMINATED</div>
                    </div>
                `;
                
                document.getElementById('strikesTitle').textContent = 'Department Eliminated!';
                document.getElementById('strikesDepartment').textContent = dept.name + ' Department';
                document.getElementById('strikesMessage').innerHTML = `
                    <strong>${dept.name}</strong> has made 3 critical errors and is no longer able to participate in crisis management decisions.
                `;
                document.getElementById('strikesWarning').innerHTML = `
                    <div class="continue-game-message">
                        üéÆ The game continues with the remaining departments!<br>
                        Other departments must work harder to compensate.
                    </div>
                `;
                popup.classList.add('department-eliminated-popup');
                
                // Mark department as eliminated
                departments[departmentKey].eliminated = true;
                
                // Don't auto-reset, just show message for 3 seconds then close
                setTimeout(() => {
                    closeStrikesPopup();
                }, 3500);
            } else {
                document.getElementById('strikesIcon').textContent = '‚ùå';
                document.getElementById('strikesTitle').textContent = 'Critical Error!';
                document.getElementById('strikesDepartment').textContent = dept.name + ' Department';
                document.getElementById('strikesMessage').textContent = 
                    `${dept.name} made a poor decision that could worsen the crisis. This decision has been recorded as a critical error.`;
                
                const remainingStrikes = 3 - strikeCount;
                document.getElementById('strikesWarning').textContent = 
                    remainingStrikes > 0 
                        ? `‚ö†Ô∏è ${remainingStrikes} more critical error(s) will eliminate this department!`
                        : 'üö® Next critical error will eliminate this department!';
                        
                popup.classList.remove('department-eliminated-popup');
            }
            
            // Update strikes counter visual
            updateStrikesCounter(strikeCount);
            
            // Show popup with animation
            overlay.classList.add('show');
        }

        function updateStrikesCounter(strikeCount) {
            const counter = document.getElementById('strikesCounter');
            counter.innerHTML = '';
            
            for (let i = 1; i <= 3; i++) {
                const indicator = document.createElement('div');
                indicator.className = 'strike-indicator';
                
                if (i <= strikeCount) {
                    indicator.classList.add('active');
                    indicator.textContent = 'X';
                } else {
                    indicator.classList.add('inactive');
                    indicator.textContent = i;
                }
                
                counter.appendChild(indicator);
            }
        }

        function closeStrikesPopup() {
            const overlay = document.getElementById('strikesOverlay');
            overlay.classList.remove('show');
        }
        
        // Initialize the game
        function initGame() {
            console.log('Initializing game...');
            renderDepartmentScores();
            document.getElementById('roundNumber').textContent = currentRound;
        }
        
        // Render department score cards
        function renderDepartmentScores() {
            const container = document.getElementById('departmentScores');
            container.innerHTML = '';
            
            Object.entries(departments).forEach(([key, dept]) => {
                const card = document.createElement('div');
                card.className = 'department-card';
                card.style.borderLeftColor = dept.color;
                
                // Add visual indicator for strikes
                let strikeIndicator = '';
                for (let i = 0; i < 3; i++) {
                    if (i < dept.strikes) {
                        strikeIndicator += '‚ùå';
                    } else {
                        strikeIndicator += '‚ö™';
                    }
                }
                
                // Check if department is eliminated
                if (dept.eliminated) {
                    card.style.opacity = '0.5';
                    card.style.background = '#f8f9fa';
                    card.innerHTML = `
                        <div class="department-name" style="color: #e74c3c;">üíÄ ${dept.name}</div>
                        <div class="department-score" style="color: #e74c3c; font-size: 1.2em;">ELIMINATED</div>
                        <div style="font-size: 0.8em; margin-top: 5px; color: #e74c3c;">3 Critical Errors</div>
                    `;
                } else {
                    card.innerHTML = `
                        <div class="department-name">${dept.name}</div>
                        <div class="department-score" style="color: ${dept.color}">${dept.score}</div>
                        <div style="font-size: 0.8em; margin-top: 5px;">${strikeIndicator}</div>
                    `;
                }
                
                container.appendChild(card);
            });
        }
        
        // Generate scenario
        // Replace the generateScenario() function in your game.html with this:

async function generateScenario() {
    console.log('Generating new scenario...');
    showLoading(true);
    hideMessage();
    
    try {
        // Create scenario directly without API call
        currentScenario = createRandomScenario();
        currentQuestionIndex = 0;
        
        console.log('Scenario created:', currentScenario.questions.length, 'questions');
        
        // Show the scenario reference
        document.getElementById('scenarioTitleRef').textContent = currentScenario.title;
        document.getElementById('scenarioContentRef').textContent = currentScenario.description;
        document.getElementById('scenarioReference').classList.remove('hidden');
        
        displayCurrentQuestion();
        
    } catch (error) {
        console.error('Error generating scenario:', error);
        showMessage(`Failed to generate scenario: ${error.message}`, 'error');
    } finally {
        showLoading(false);
    }
}

// Add this new function to create scenarios
function createRandomScenario() {
    const scenarioTemplates = [
        {
            type: 'cyberattack',
            title: 'Ransomware Attack Cripples Banking Systems',
            description: 'A sophisticated ransomware group has infiltrated the bank\'s network, encrypting critical systems including core banking, loan servicing, and customer databases. The attackers demand $2.5 million in cryptocurrency within 72 hours. Customer online banking is down, ATMs are offline, and branch operations are severely limited. The FBI has been notified. Markets open in 5 hours.',
            icon: 'üîí'
        },
        {
            type: 'natural_disaster',
            title: 'Category 4 Hurricane Devastates Regional Operations',
            description: 'Hurricane Marina has made landfall as a Category 4 storm, forcing evacuation of 12 of 18 branches across three states. Widespread power outages affect 450,000 customers. Flooding has damaged two branches and a regional operations center. Storm surge reached 8 feet in coastal areas. The area will be inaccessible for 72-96 hours. Local businesses are shut down with economic impact estimated at $800 million.',
            icon: 'üå™Ô∏è'
        },
        {
            type: 'disgruntled_employee',
            title: 'Former IT Employee Sabotages Critical Systems',
            description: 'A recently terminated IT administrator has used retained access credentials to delete critical databases, corrupt backup systems, and expose sensitive customer data on social media. The employee posted internal emails and customer information online, claiming the bank engages in discriminatory practices. Local news is picking up the story. Customer trust is at risk.',
            icon: 'üò°'
        },
        {
            type: 'regulatory_crisis',
            title: 'Federal Investigation into Fair Lending Violations',
            description: 'The DOJ and CFPB have launched a joint investigation into alleged discriminatory lending practices. Federal agents are on-site with search warrants, reviewing mortgage and small business loan records from the past three years. A whistleblower complaint alleges systematic bias affecting minority communities. The stock price has dropped 12% in pre-market trading.',
            icon: '‚öñÔ∏è'
        },
        {
            type: 'economic_collapse',
            title: 'Regional Economic Crisis Following Major Employer Bankruptcies',
            description: 'Three major regional employers representing 15,000 jobs have filed bankruptcy within two weeks. Unemployment spiked from 3.2% to 11.8% overnight. Loan delinquency rates jumped from 2.1% to 7.4% in thirty days. Customer deposits are declining as people withdraw savings. Real estate values dropped 15%. Small businesses are requesting emergency loans while defaulting on existing credit.',
            icon: 'üìâ'
        },
        {
            type: 'data_breach',
            title: 'Massive Customer Data Breach Exposes Personal Information',
            description: 'Hackers have breached the customer database, accessing Social Security numbers, account numbers, and transaction histories for 200,000 customers. The breach occurred through a third-party vendor\'s compromised system. Customers are reporting fraudulent transactions. Credit monitoring services are overwhelmed. Regulatory notifications are required within 24 hours.',
            icon: 'üï≥Ô∏è'
        },
        {
            type: 'workplace_violence',
            title: 'Active Threat Situation at Main Branch',
            description: 'A former customer who had their home foreclosed has entered the main branch with a weapon, demanding to speak with executives. Police have surrounded the building. Employees and customers are locked down inside. Media is gathering outside. Other branches need immediate security assessments. The situation is being broadcast live on local news.',
            icon: 'üö®'
        },
        {
            type: 'pandemic_response',
            title: 'Pandemic Forces Immediate Operational Changes',
            description: 'A new variant of a contagious disease has led to government-mandated business restrictions. 60% of staff must work remotely immediately. Customer-facing services must be limited. Cash handling procedures need revision. Drive-through services are overwhelmed. Digital banking systems are experiencing 300% increased usage. Loan payment deferrals are being requested en masse.',
            icon: 'üò∑'
        }
    ];
    
    // Randomly select a scenario type
    const selectedTemplate = scenarioTemplates[Math.floor(Math.random() * scenarioTemplates.length)];
    
    // Create questions for all departments
    const questions = createDepartmentQuestions(selectedTemplate);
    
    return {
        title: selectedTemplate.title,
        description: selectedTemplate.description,
        type: selectedTemplate.type,
        icon: selectedTemplate.icon,
        questions: shuffleArray(questions) // Randomize question order
    };
}

function createDepartmentQuestions(scenario) {
    const departments = ['CEO_SVPs', 'IT_Security', 'HR', 'Finance', 'Loans', 'Accounting', 'Deposits'];
    const questions = [];
    
    // Create 3 questions per department (21 total)
    departments.forEach(dept => {
        const deptQuestions = generateDepartmentSpecificQuestions(dept, scenario);
        questions.push(...deptQuestions);
    });
    
    return questions;
}

function generateDepartmentSpecificQuestions(department, scenario) {
    const questionSets = {
        'CEO_SVPs': {
            'cyberattack': [
                {
                    questionText: 'How do you immediately communicate the ransomware attack to stakeholders?',
                    options: [
                        { text: 'Issue immediate public statement with full details of the breach', impacts: { 'CEO_SVPs': -20, 'IT_Security': -10, 'HR': -5 } },
                        { text: 'Coordinate with legal team and issue measured statement after assessment', impacts: { 'CEO_SVPs': 25, 'IT_Security': 10, 'HR': 5 } },
                        { text: 'Wait until systems are restored before making any public announcements', impacts: { 'CEO_SVPs': -15, 'IT_Security': -5, 'HR': -10 } }
                    ]
                },
                {
                    questionText: 'What is your decision regarding the $2.5 million ransom demand?',
                    options: [
                        { text: 'Pay the ransom immediately to restore operations quickly', impacts: { 'CEO_SVPs': -25, 'IT_Security': -15, 'Finance': -20 } },
                        { text: 'Refuse to pay and focus all resources on system recovery', impacts: { 'CEO_SVPs': 20, 'IT_Security': 15, 'Finance': 10 } },
                        { text: 'Negotiate with attackers while pursuing parallel recovery options', impacts: { 'CEO_SVPs': -10, 'IT_Security': 5, 'Finance': -5 } }
                    ]
                },
                {
                    questionText: 'How do you manage the crisis with markets opening in 5 hours?',
                    options: [
                        { text: 'Request trading halt and emergency board meeting', impacts: { 'CEO_SVPs': 22, 'Finance': 15, 'Accounting': 10 } },
                        { text: 'Issue confidence statement and continue normal trading', impacts: { 'CEO_SVPs': -18, 'Finance': -10, 'Accounting': -5 } },
                        { text: 'Coordinate with regulators before making any market decisions', impacts: { 'CEO_SVPs': 18, 'Finance': 12, 'Accounting': 8 } }
                    ]
                }
            ],
            'natural_disaster': [
                {
                    questionText: 'How do you coordinate the bank\'s response to the hurricane disaster?',
                    options: [
                        { text: 'Activate disaster response plan and coordinate with emergency management', impacts: { 'CEO_SVPs': 25, 'HR': 15, 'IT_Security': 10 } },
                        { text: 'Focus primarily on protecting bank assets and facilities', impacts: { 'CEO_SVPs': -15, 'HR': -20, 'IT_Security': -5 } },
                        { text: 'Wait for government guidance before taking action', impacts: { 'CEO_SVPs': -20, 'HR': -15, 'IT_Security': -10 } }
                    ]
                },
                {
                    questionText: 'What is your strategy for supporting affected communities?',
                    options: [
                        { text: 'Immediately announce loan payment deferrals and emergency credit programs', impacts: { 'CEO_SVPs': 20, 'Loans': 15, 'HR': 10 } },
                        { text: 'Maintain normal lending standards to protect bank stability', impacts: { 'CEO_SVPs': -18, 'Loans': -15, 'HR': -10 } },
                        { text: 'Partner with government agencies for coordinated disaster relief', impacts: { 'CEO_SVPs': 22, 'Loans': 12, 'HR': 8 } }
                    ]
                },
                {
                    questionText: 'How do you address business continuity with 12 branches closed?',
                    options: [
                        { text: 'Deploy mobile banking units and expand digital services immediately', impacts: { 'CEO_SVPs': 23, 'IT_Security': 15, 'Deposits': 12 } },
                        { text: 'Redirect customers to remaining open branches only', impacts: { 'CEO_SVPs': -12, 'IT_Security': -5, 'Deposits': -15 } },
                        { text: 'Temporarily suspend services until branches can reopen', impacts: { 'CEO_SVPs': -25, 'IT_Security': -10, 'Deposits': -20 } }
                    ]
                }
            ],
            'disgruntled_employee': [
                {
                    questionText: 'How do you respond to the former employee\'s public data exposure?',
                    options: [
                        { text: 'Immediately issue public apology and admit to all allegations', impacts: { 'CEO_SVPs': -25, 'HR': -15, 'IT_Security': -10 } },
                        { text: 'Issue measured response addressing security while investigating claims', impacts: { 'CEO_SVPs': 20, 'HR': 10, 'IT_Security': 15 } },
                        { text: 'Deny all allegations and focus solely on legal action', impacts: { 'CEO_SVPs': -15, 'HR': -20, 'IT_Security': -5 } }
                    ]
                },
                {
                    questionText: 'What is your strategy for managing the media crisis?',
                    options: [
                        { text: 'Hold immediate press conference to address all concerns', impacts: { 'CEO_SVPs': 18, 'HR': 12, 'IT_Security': 8 } },
                        { text: 'Avoid media contact until legal team develops strategy', impacts: { 'CEO_SVPs': -20, 'HR': -10, 'IT_Security': -5 } },
                        { text: 'Provide written statement only and refer to ongoing investigation', impacts: { 'CEO_SVPs': 15, 'HR': 8, 'IT_Security': 10 } }
                    ]
                },
                {
                    questionText: 'How do you restore customer confidence after the data breach?',
                    options: [
                        { text: 'Offer free credit monitoring and identity protection services', impacts: { 'CEO_SVPs': 22, 'HR': 10, 'Finance': 5 } },
                        { text: 'Minimize the issue and emphasize bank\'s overall security', impacts: { 'CEO_SVPs': -18, 'HR': -15, 'Finance': -10 } },
                        { text: 'Launch comprehensive transparency initiative with regular updates', impacts: { 'CEO_SVPs': 25, 'HR': 15, 'Finance': 8 } }
                    ]
                }
            ]
        },
        'IT_Security': {
            'cyberattack': [
                {
                    questionText: 'What is your immediate response to isolate the ransomware infection?',
                    options: [
                        { text: 'Immediately shut down all network connections and systems', impacts: { 'IT_Security': 25, 'CEO_SVPs': 10, 'Deposits': -5 } },
                        { text: 'Attempt to identify infected systems while maintaining operations', impacts: { 'IT_Security': -20, 'CEO_SVPs': -10, 'Deposits': -15 } },
                        { text: 'Focus on backing up uninfected data before taking action', impacts: { 'IT_Security': -15, 'CEO_SVPs': -5, 'Deposits': -10 } }
                    ]
                },
                {
                    questionText: 'How do you prioritize system recovery to restore critical functions?',
                    options: [
                        { text: 'Restore core banking systems first, then customer-facing services', impacts: { 'IT_Security': 22, 'Deposits': 15, 'Loans': 10 } },
                        { text: 'Focus on customer-facing systems to minimize service disruption', impacts: { 'IT_Security': -10, 'Deposits': -5, 'Loans': -8 } },
                        { text: 'Restore all systems simultaneously using all available resources', impacts: { 'IT_Security': -18, 'Deposits': -10, 'Loans': -12 } }
                    ]
                },
                {
                    questionText: 'What forensic investigation steps should be taken immediately?',
                    options: [
                        { text: 'Preserve all logs and evidence before starting any recovery', impacts: { 'IT_Security': 20, 'CEO_SVPs': 15, 'Accounting': 10 } },
                        { text: 'Focus on recovery first, investigate after systems are restored', impacts: { 'IT_Security': -15, 'CEO_SVPs': -10, 'Accounting': -5 } },
                        { text: 'Coordinate with FBI cyber team before taking any action', impacts: { 'IT_Security': 18, 'CEO_SVPs': 12, 'Accounting': 8 } }
                    ]
                }
            ],
            'natural_disaster': [
                {
                    questionText: 'How do you protect critical IT infrastructure from hurricane damage?',
                    options: [
                        { text: 'Activate backup data center and ensure all data is replicated', impacts: { 'IT_Security': 25, 'CEO_SVPs': 15, 'Accounting': 10 } },
                        { text: 'Focus on protecting physical servers at primary location', impacts: { 'IT_Security': -15, 'CEO_SVPs': -10, 'Accounting': -8 } },
                        { text: 'Wait to see extent of damage before taking protective measures', impacts: { 'IT_Security': -25, 'CEO_SVPs': -20, 'Accounting': -15 } }
                    ]
                },
                {
                    questionText: 'What backup systems should be activated when primary data centers are threatened?',
                    options: [
                        { text: 'Immediately switch to disaster recovery site with full capabilities', impacts: { 'IT_Security': 22, 'Deposits': 15, 'Loans': 12 } },
                        { text: 'Activate limited backup systems for essential functions only', impacts: { 'IT_Security': 10, 'Deposits': 5, 'Loans': 3 } },
                        { text: 'Keep primary systems running until actual damage occurs', impacts: { 'IT_Security': -20, 'Deposits': -15, 'Loans': -12 } }
                    ]
                },
                {
                    questionText: 'How do you ensure network connectivity when telecommunications are damaged?',
                    options: [
                        { text: 'Deploy satellite internet and mobile hotspots immediately', impacts: { 'IT_Security': 20, 'HR': 10, 'Deposits': 8 } },
                        { text: 'Wait for telecom companies to restore primary connections', impacts: { 'IT_Security': -18, 'HR': -12, 'Deposits': -15 } },
                        { text: 'Use cellular networks as temporary solution', impacts: { 'IT_Security': 15, 'HR': 8, 'Deposits': 10 } }
                    ]
                }
            ],
            'disgruntled_employee': [
                {
                    questionText: 'How do you immediately secure systems after discovering the former employee\'s access?',
                    options: [
                        { text: 'Immediately disable all accounts and change all system passwords', impacts: { 'IT_Security': 25, 'HR': 15, 'CEO_SVPs': 10 } },
                        { text: 'Monitor the employee\'s actions to gather evidence first', impacts: { 'IT_Security': -20, 'HR': -15, 'CEO_SVPs': -10 } },
                        { text: 'Selectively disable access while maintaining system functionality', impacts: { 'IT_Security': -10, 'HR': -5, 'CEO_SVPs': -8 } }
                    ]
                },
                {
                    questionText: 'What steps should be taken to assess the extent of data compromise?',
                    options: [
                        { text: 'Conduct immediate comprehensive security audit of all systems', impacts: { 'IT_Security': 22, 'Accounting': 15, 'CEO_SVPs': 12 } },
                        { text: 'Focus audit only on systems the employee had access to', impacts: { 'IT_Security': 10, 'Accounting': 5, 'CEO_SVPs': 3 } },
                        { text: 'Wait for law enforcement guidance before conducting audit', impacts: { 'IT_Security': -15, 'Accounting': -10, 'CEO_SVPs': -12 } }
                    ]
                },
                {
                    questionText: 'How do you prevent similar security breaches in the future?',
                    options: [
                        { text: 'Implement immediate access revocation procedures and regular audits', impacts: { 'IT_Security': 20, 'HR': 12, 'CEO_SVPs': 8 } },
                        { text: 'Add additional monitoring without changing current procedures', impacts: { 'IT_Security': -5, 'HR': -3, 'CEO_SVPs': -8 } },
                        { text: 'Review and strengthen all employee termination security protocols', impacts: { 'IT_Security': 18, 'HR': 15, 'CEO_SVPs': 10 } }
                    ]
                }
            ]
        },
        // Add similar question sets for other departments...
        'HR': {
            'cyberattack': [
                {
                    questionText: 'How do you manage employee communications about the cybersecurity incident?',
                    options: [
                        { text: 'Send detailed email explaining the situation and safety measures', impacts: { 'HR': 20, 'CEO_SVPs': 10, 'IT_Security': 8 } },
                        { text: 'Hold emergency all-hands meeting to address concerns', impacts: { 'HR': 25, 'CEO_SVPs': 15, 'IT_Security': 10 } },
                        { text: 'Minimize communication to prevent panic and rumors', impacts: { 'HR': -20, 'CEO_SVPs': -15, 'IT_Security': -10 } }
                    ]
                },
                {
                    questionText: 'What staffing adjustments are needed when digital systems are down?',
                    options: [
                        { text: 'Implement manual processes and redeploy staff to critical functions', impacts: { 'HR': 22, 'Deposits': 15, 'Loans': 10 } },
                        { text: 'Send non-essential employees home until systems are restored', impacts: { 'HR': -15, 'Deposits': -20, 'Loans': -18 } },
                        { text: 'Maintain normal staffing and wait for IT resolution', impacts: { 'HR': -10, 'Deposits': -12, 'Loans': -8 } }
                    ]
                },
                {
                    questionText: 'How do you handle employees who may have been phishing email targets?',
                    options: [
                        { text: 'Provide immediate security training and counseling support', impacts: { 'HR': 18, 'IT_Security': 12, 'CEO_SVPs': 8 } },
                        { text: 'Investigate and potentially discipline employees involved', impacts: { 'HR': -20, 'IT_Security': -10, 'CEO_SVPs': -15 } },
                        { text: 'Focus on system recovery without addressing individual involvement', impacts: { 'HR': -12, 'IT_Security': -8, 'CEO_SVPs': -5 } }
                    ]
                }
            ]
        },
        'Finance': {
            'cyberattack': [
                {
                    questionText: 'How do you assess the immediate financial impact of the ransomware attack?',
                    options: [
                        { text: 'Calculate direct costs, lost revenue, and recovery expenses immediately', impacts: { 'Finance': 25, 'CEO_SVPs': 15, 'Accounting': 10 } },
                        { text: 'Wait until systems are restored to assess financial impact', impacts: { 'Finance': -20, 'CEO_SVPs': -15, 'Accounting': -12 } },
                        { text: 'Focus only on immediate operational costs', impacts: { 'Finance': -10, 'CEO_SVPs': -8, 'Accounting': -5 } }
                    ]
                },
                {
                    questionText: 'What is your approach to managing the $2.5 million ransom payment decision?',
                    options: [
                        { text: 'Analyze cost-benefit of paying ransom versus recovery costs', impacts: { 'Finance': 20, 'CEO_SVPs': 12, 'IT_Security': 8 } },
                        { text: 'Recommend against payment due to financial and ethical concerns', impacts: { 'Finance': 22, 'CEO_SVPs': 18, 'IT_Security': 15 } },
                        { text: 'Support immediate payment to minimize financial losses', impacts: { 'Finance': -25, 'CEO_SVPs': -20, 'IT_Security': -15 } }
                    ]
                },
                {
                    questionText: 'How do you handle cyber insurance claims during this incident?',
                    options: [
                        { text: 'Immediately contact insurance providers and begin claims process', impacts: { 'Finance': 25, 'CEO_SVPs': 15, 'Accounting': 10 } },
                        { text: 'Document all costs first before contacting insurance', impacts: { 'Finance': 15, 'CEO_SVPs': 8, 'Accounting': 12 } },
                        { text: 'Handle costs internally without involving insurance initially', impacts: { 'Finance': -18, 'CEO_SVPs': -12, 'Accounting': -8 } }
                    ]
                }
            ]
        }
        // Continue with other departments and scenarios...
    };
    
    // Get questions for this department and scenario type, or use generic questions
    const deptQuestions = questionSets[department]?.[scenario.type] || generateGenericQuestions(department, scenario);
    
    return deptQuestions.map((q, index) => ({
        questionNumber: index + 1,
        department: department,
        questionText: q.questionText,
        options: q.options
    }));
}

function generateGenericQuestions(department, scenario) {
    // Generic fallback questions when specific ones aren't defined
    return [
        {
            questionText: `How should the ${department.replace('_', '/')} department respond to this crisis situation?`,
            options: [
                { text: 'Implement emergency procedures and coordinate with other departments', impacts: { [department]: 20 } },
                { text: 'Continue normal operations while monitoring the situation', impacts: { [department]: -15 } },
                { text: 'Wait for executive direction before taking action', impacts: { [department]: -10 } }
            ]
        },
        {
            questionText: `What resources should ${department.replace('_', '/')} prioritize during this crisis?`,
            options: [
                { text: 'Focus all resources on crisis response and recovery', impacts: { [department]: 22 } },
                { text: 'Balance crisis response with maintaining normal operations', impacts: { [department]: 10 } },
                { text: 'Prioritize protecting departmental assets and staff', impacts: { [department]: -12 } }
            ]
        },
        {
            questionText: `How should ${department.replace('_', '/')} communicate with stakeholders during this crisis?`,
            options: [
                { text: 'Provide frequent, transparent updates about the situation', impacts: { [department]: 18 } },
                { text: 'Share information only when specifically requested', impacts: { [department]: -8 } },
                { text: 'Limit communication to avoid causing additional panic', impacts: { [department]: -15 } }
            ]
        }
    ];
}

function shuffleArray(array) {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
}
        // Initialize game
        initGame();
        console.log('Game ready!');
    </script>
</body>
</html>