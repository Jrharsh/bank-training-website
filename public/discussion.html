<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Tabletop Scenario Generator</title>
        <link rel="stylesheet" href="/css/style.css">
        <script src="js/discussion-scenarios.js"></script>
        <script>
        // Keep minimal: theme.js will handle toggle and OS scheme
        </script>
        <style>
            body {
                font-family: 'Segoe UI', Arial, sans-serif;
                margin: 0;
                min-height: 100vh;
            }
            .container {
                max-width: 1100px;
                margin: 0 auto;
                padding: 32px 16px 48px 16px;
            }
            .controls {
                background: transparent;
                border-radius: 0;
                box-shadow: none;
                padding: 0;
                margin-bottom: 0;
                margin-top: 18px;
                border: none;
            }
            .header {
                text-align: center;
                margin-bottom: 24px;
            }
            .header h1 {
                font-size: 2.3rem;
                margin-bottom: 0.5rem;
            }
            .header p {
                color: #b0b8c1;
                font-size: 1.1rem;
            }
            .status-indicator {
                background: #f5f7fa;
                color: #28a745;
                padding: 8px 18px;
                border-radius: 6px;
                margin-bottom: 18px;
                font-family: monospace;
                font-size: 1rem;
                border-left: 4px solid #28a745;
                box-shadow: none;
                transition: background 0.2s, color 0.2s;
            }
            .status-indicator.error {
                border-left-color: #dc3545;
                background: #ffeaea;
                color: #dc3545;
            }
            .steps-bar {
                text-align: center;
                margin-bottom: 24px;
                font-size: 1.3rem;
                font-weight: 600;
                color: #fff;
            }
            .steps-bar .step-label {
                color: #fff;
            }
            .steps-bar {
                        margin-bottom: 32px;
                        font-size: 1.35rem;
                        font-weight: 700;
                        letter-spacing: 0.01em;
                font-size: 1.15rem;
                font-weight: 600;
            }
            .steps-bar .step-number {
                color: #2196f3;
                font-size: 1.15rem;
                font-weight: 700;
                margin-right: 4px;
            }
            .department-grid {
                        gap: 28px;
                        margin: 0 auto 38px auto;
                        max-width: 900px;
                        background: linear-gradient(120deg, #e3eafc 0%, #fbe3e3 100%) !important;
                        border-radius: 14px;
                        padding: 18px 0 10px 0;
                        border: none !important;
            }
            .department-grid {
                display: grid;
                grid-template-columns: repeat(5, 1fr);
                gap: 20px;
                margin: 0 auto 32px auto;
                max-width: 700px;
                justify-content: center;
            }
            .department-card {
                background: rgba(255,255,255,0.82);
                box-shadow: 0 2px 12px rgba(0,0,0,0.08);
                border-radius: 16px;
                color: #222;
                border-radius: 12px;
                        border-radius: 16px;
                        padding: 36px 0 20px 0;
                        border: 2.5px solid transparent;
                        transition: border 0.18s, background 0.18s, box-shadow 0.18s, transform 0.12s;
                        font-size: 1.18rem;
                            will-change: transform, box-shadow;
                    padding: 28px 0 16px 0;
                    text-align: center;
                    cursor: pointer;
                    border: 2px solid transparent;
                }
                .department-card.selected, .department-card:hover {
                        border: 2.5px solid #2196f3;
                        box-shadow: 0 8px 32px rgba(33,150,243,0.13);
                        transform: scale(1.045);
                        z-index: 2;
                transition: border 0.2s, background 0.2s, box-shadow 0.2s;
                font-size: 1.15rem;
                box-shadow: 0 2px 12px rgba(33,150,243,0.04);
            }
            .department-icon {
                        font-size: 2.7rem;
                        margin-bottom: 16px;
                        display: block;
            }
            .department-card.selected, .department-card:hover {
                border: 2px solid #2196f3;
                background: #e3eafc;
                box-shadow: 0 4px 18px rgba(33,150,243,0.10);
            }
            .department-icon {
                font-size: 2.2rem;
                margin-bottom: 10px;
            }
            .complexity-options {
                display: flex;
                flex-direction: row;
                justify-content: center;
                align-items: center;
                gap: 18px;
                margin-bottom: 12px;
                max-width: 900px;
                margin-left: auto;
                margin-right: auto;
            }
            .complexity-option {
                background: rgba(255,255,255,0.92);
                box-shadow: 0 2px 12px rgba(0,0,0,0.08);
                border-radius: 16px;
                padding: 20px 18px;
                font-size: 1.05rem;
                font-weight: 700;
                transition: border 0.18s, background 0.18s, box-shadow 0.18s, transform 0.12s;
                margin-top: 0;
                letter-spacing: 0.01em;
                will-change: transform, box-shadow;
                cursor: pointer;
                border: 2px solid transparent;
                min-width: 160px;
                text-align: center;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                color: #222;
            }
            .complexity-option.selected, .complexity-option:hover {
                border: 2px solid #2196f3;
                background: #e3eafc;
                box-shadow: 0 4px 18px rgba(33,150,243,0.10);
                transform: scale(1.03);
                color: #0b2540;
            }
            .selected-badge {
                background: rgba(255,255,255,0.92);
                box-shadow: 0 2px 12px rgba(0,0,0,0.08);
                border-radius: 12px;
                padding: 8px 12px;
                display: inline-block;
                border: 2px solid transparent;
                min-width: 220px;
                justify-content: center;
                align-items: center;
            }
            .selected-badge.show {
                border-color: #2196f3;
                background: #e3eafc;
            }
            .complexity-label {
                font-weight: 700;
                font-size: 1.05rem;
                color: #222;
            }
            .complexity-desc {
                color: #6c757d;
                font-size: 0.88rem;
                margin-top: 6px;
            }
            @media (max-width: 768px) {
                .complexity-options {
                    flex-direction: column;
                    gap: 12px;
                }
                .complexity-option {
                    min-width: 0;
                    width: 100%;
                }
            }
            .generate-btn {
                background: linear-gradient(135deg, #28d17c, #1abc9c);
                        box-shadow: none;
            }
            /* complexity styles above supersede older dark-theme rules */
            .generate-section {
                display: flex;
                justify-content: center;
                margin: 0 auto 0 auto;
                background: #fff;
                border-radius: 12px;
                box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            }
            .generate-btn {
                background: linear-gradient(135deg, #e3eafc, #fbe3e3);
                color: #222;
                border: none;
                padding: 16px 48px;
                border-radius: 12px;
                font-size: 1.25rem;
                font-weight: 700;
                cursor: pointer;
                transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
                box-shadow: 0 2px 16px rgba(40,209,124,0.10);
                margin-top: 10px;
            }
            .generate-btn:disabled {
                background: #444c56;
                color: #b0b8c1;
                cursor: not-allowed;
            }
            .scenario-output {
                margin-top: 40px;
                display: none;
            }
            .scenario-header {
                display: flex;
                align-items: center;
                gap: 18px;
                margin-bottom: 18px;
            }
            .scenario-icon {
                font-size: 2.2rem;
            }
            .scenario-title h3 {
                margin: 0 0 4px 0;
                font-size: 1.4rem;
            }
            .scenario-title p {
                margin: 0;
                color: #b0b8c1;
                font-size: 1rem;
            }
            .refresh-btn {
                background: linear-gradient(135deg, #17a2b8, #138496);
                color: white;
                border: none;
                padding: 10px 25px;
                border-radius: 25px;
                font-size: 1rem;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.3s ease;
                margin-left: 15px;
            }
            .refresh-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(23, 162, 184, 0.4);
            }
            .discussion-points {
                background: #e6f9f0;
                border-radius: 12px;
                padding: 20px;
                border-left: 5px solid #28d17c;
                color: #222;
                margin-top: 24px;
            }
            .discussion-points h4 {
                color: #1abc9c;
                margin: 0 0 15px 0;
                font-size: 1.3rem;
            }
            .discussion-points ul {
                margin: 0;
                padding-left: 20px;
            }
            .discussion-points li {
                color: #17a2b8;
                margin-bottom: 10px;
                font-size: 1.05rem;
            }
            .back-btn {
                background: transparent;
                color: #b0b8c1;
                border: 2px solid #2c3e50;
                padding: 10px 20px;
                border-radius: 8px;
                text-decoration: none;
                display: inline-block;
                margin-bottom: 20px;
                transition: all 0.3s ease;
            }
            .back-btn:hover {
                background: #2c3e50;
                color: white;
            }
            @media (max-width: 1024px) {
                .department-grid {
                    grid-template-columns: repeat(3, 1fr);
                }
            }
            @media (max-width: 768px) {
                .container {
                    padding: 12px 2vw 32px 2vw;
                }
                .selectors-row {
                    flex-direction: column;
                    gap: 18px;
                }
                .department-grid {
                    grid-template-columns: repeat(2, 1fr);
                }
                .complexity-options {
                    grid-template-columns: 1fr;
                }
                .scenario-header {
                    flex-direction: column;
                    text-align: center;
                }
                .generate-section {
                    margin-left: 0;
                    margin-top: 18px;
                    justify-content: flex-start;
                }
            }

            /* Grid styles removed to allow explicit two-row flex layout */
        </style>
    </head>
    <body class="ttsg">
    <a href="/" class="back-menu-btn">‚Üê Back to Main Menu</a>
    <div class="container">
        
        <div class="header">
            <img src="/images/bank-logo.png" alt="SSBTX Bank Logo">
            <h1>Tabletop Scenario Generator</h1>
            <p style="color:#b0b8c1; font-size:1.13rem; font-weight:500; margin-top:10px;">
                Select a department below and click <span style="color:#28d17c; font-weight:700;">Generate Scenario</span> to view a training scenario.
            </p>
        </div>

        <div class="status-indicator" id="statusIndicator" style="display:none;">
            <strong>Status:</strong> <span id="statusText">Ready to generate scenarios</span>
        </div>

        <div id="departmentSelectedBadge" class="selected-badge" style="display:none; margin-bottom:12px; text-align:center;">
            <span style="font-weight:700; color:#222;">Selected Department:</span>
            <span id="selectedDeptName" style="margin-left:8px; font-weight:700; color:#0b2540;">None</span>
        </div>

        <div class="controls">
            <div id="departmentGrid">
                <!-- Departments populated by JavaScript -->
            </div>
        </div>

        <div class="complexity-options" style="margin-bottom: 18px; max-width: 600px; margin-left: auto; margin-right: auto;">
            <div class="complexity-option selected" data-complexity="intermediate">
                <div class="complexity-label">Intermediate</div>
                <div class="complexity-desc">Standard scenario, moderate challenge</div>
            </div>
            <div class="complexity-option" data-complexity="advanced">
                <div class="complexity-label">Advanced</div>
                <div class="complexity-desc">Complex scenario, high challenge</div>
            </div>
            <div class="complexity-option" data-complexity="specialized">
                <div class="complexity-label">Specialized</div>
                <div class="complexity-desc">Niche or expert-level scenario</div>
            </div>
        </div>

        <div class="generate-section" style="margin-bottom: 32px;">
            <button class="generate-btn" id="generateBtn" disabled style="padding:10px 22px; font-size:1rem; border-radius:8px;">
                <span class="loading-spinner"></span>
                <span id="generateBtnText">Generate Scenario</span>
            </button>
        </div>

        <div class="scenario-output" id="scenarioOutput" style="display:none;">
            <div class="scenario-header" style="background:#fff; border-radius:12px; box-shadow:0 2px 12px rgba(0,0,0,0.08); padding:24px; color:#222;">
                <div class="scenario-icon" id="scenarioIcon">üè¢</div>
                <div class="scenario-title">
                    <h3 id="scenarioTitle">Scenario Title</h3>
                    <p id="scenarioDepartment">Department Name</p>
                </div>
                <button class="refresh-btn" onclick="generateScenario()">üîÑ Generate New</button>
            </div>

            <div class="scenario-content" id="scenarioContent" style="background:#fff; border-radius:12px; box-shadow:0 2px 12px rgba(0,0,0,0.08); color:#222; margin-top:18px; padding:18px;">
                <!-- AI-generated scenario will appear here -->
            </div>

            <div class="discussion-points" id="discussionSection" style="background:#fff; border-radius:12px; box-shadow:0 2px 12px rgba(0,0,0,0.08); color:#222; margin-top:18px; padding:18px;">
                <h4>üí≠ Discussion Points</h4>
                <ul id="discussionPoints">
                    <!-- AI-generated discussion points will appear here -->
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Replace just the <script> section in your existing discussion.html file with this:

let selectedDepartment = null;
let selectedComplexity = 'intermediate';

const departments = [
    { id: 'Deposits', name: 'Deposits', icon: 'üíµ' },
    { id: 'Tellers', name: 'Tellers', icon: 'üè¶' },
    { id: 'Loans', name: 'Loans', icon: 'üßæ' },
    { id: 'Accounting', name: 'Accounting', icon: 'üìä' },
    { id: 'Bookkeeping', name: 'Bookkeeping', icon: 'üóÇÔ∏è' },
    { id: 'Loan Servicing', name: 'Loan Servicing', icon: 'üõ†Ô∏è' },
    { id: 'Compliance', name: 'Compliance', icon: '‚öñÔ∏è' },
    { id: 'IT', name: 'IT', icon: 'üíª' },
    { id: 'Security', name: 'Security', icon: 'üîê' },
    { id: 'New Accounts', name: 'New Accounts', icon: 'üìù' }
];

function updateStatus(message, isError = false) {
    // Hide status indicator for static/offline mode except for debugging
    const statusIndicator = document.getElementById('statusIndicator');
    const statusText = document.getElementById('statusText');
    if (isError) {
        statusText.textContent = message;
        statusIndicator.className = 'status-indicator error';
        statusIndicator.style.display = '';
    } else {
        // Hide status for normal operation
        statusIndicator.style.display = 'none';
    }
    // Console log for debugging
    console.log(`[STATUS] ${message}`, isError ? '(ERROR)' : '');
}

function createDepartmentCards() {
    const grid = document.getElementById('departmentGrid');
    grid.innerHTML = '';

    departments.forEach((dept, index) => {
        const card = document.createElement('div');
        card.className = 'department-card';

        // emoji-only icon (no image assets required)
        const iconCircle = document.createElement('div');
        iconCircle.className = 'department-icon-circle';
        const iconWrap = document.createElement('div');
        iconWrap.className = 'department-icon';
        iconWrap.textContent = dept.icon;
        // sizing handled by CSS

        const name = document.createElement('div');
        name.className = 'department-name';
        name.textContent = dept.name;
        // spacing handled by CSS

        iconCircle.appendChild(iconWrap);
        card.appendChild(iconCircle);
        card.appendChild(name);

        card.addEventListener('click', () => selectDepartment(dept.id, card));

        grid.appendChild(card);
    });
    // Grid enforces 5 columns; 10 cards render as 5 top + 5 bottom
    
    updateStatus(`${departments.length} departments loaded`);
}

function selectDepartment(deptId, cardElement) {
    // Remove selection from all cards
    document.querySelectorAll('.department-card').forEach(card => {
        card.classList.remove('selected');
    });
    
    // Add selection to clicked card
    cardElement.classList.add('selected');
    selectedDepartment = deptId;
    
    // Enable generate button if department is selected
    updateGenerateButton();
    updateStatus(`Selected department: ${departments.find(d => d.id === deptId).name}`);
    // Update selected-department badge
    const badge = document.getElementById('departmentSelectedBadge');
    const badgeName = document.getElementById('selectedDeptName');
    if (badge && badgeName) {
        badgeName.textContent = departments.find(d => d.id === deptId).name;
        badge.style.display = '';
        badge.classList.add('show');
    }
}

function setupComplexitySelector() {
    const options = document.querySelectorAll('.complexity-option');
    
    options.forEach(option => {
        option.addEventListener('click', () => {
            // Remove selection from all options
            options.forEach(opt => opt.classList.remove('selected'));
            
            // Add selection to clicked option
            option.classList.add('selected');
            selectedComplexity = option.dataset.complexity;
            
            updateStatus(`Complexity set to: ${selectedComplexity}`);
        });
    });
}

function updateGenerateButton() {
    const generateBtn = document.getElementById('generateBtn');
    generateBtn.disabled = !selectedDepartment;
}

function generateScenario() {
    if (!selectedDepartment) {
        updateStatus('Please select a department first', true);
        return;
    }

    const generateBtn = document.getElementById('generateBtn');
    const generateBtnText = document.getElementById('generateBtnText');

    // Show loading state
    generateBtn.classList.add('loading');
    generateBtn.disabled = true;
    generateBtnText.textContent = 'Generating scenario...';
    updateStatus('Generating scenario from templates...');

    // Use discussion-scenarios.js data
    try {
        // Find scenarios for the selected department
        let scenarios = window.discussionScenarios && window.discussionScenarios[selectedDepartment];
        if (!scenarios || !Array.isArray(scenarios) || scenarios.length === 0) {
            throw new Error('No scenarios found for this department');
        }
        // Pick a random scenario
        const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
        displayScenario(scenario);
        updateStatus('Scenario generated successfully.');
    } catch (error) {
        console.error('[DEBUG] Error:', error);
        updateStatus(`Error: ${error.message}`, true);
        displayErrorFallback();
    } finally {
        // Reset button state
        generateBtn.classList.remove('loading');
        generateBtn.disabled = false;
        generateBtnText.textContent = 'Generate Scenario';
    }
}

function displayScenario(data) {
    console.log('[DEBUG] Displaying scenario:', data);
    
    const dept = departments.find(d => d.id === selectedDepartment);
    
    // Update header
    document.getElementById('scenarioIcon').textContent = dept.icon;
    document.getElementById('scenarioTitle').textContent = data.title || 'AI Generated Scenario';
    document.getElementById('scenarioDepartment').textContent = `${dept.name} Department - ${selectedComplexity.charAt(0).toUpperCase() + selectedComplexity.slice(1)} Level`;
    
    // Update content - handle multiple possible field names
    const scenarioText = data.description || data.scenario || 'Scenario description not available';
    document.getElementById('scenarioContent').textContent = scenarioText;
    
    // Update discussion points
    const discussionContainer = document.getElementById('discussionPoints');
    discussionContainer.innerHTML = '';
    
    // Handle multiple possible field names
    const discussionPoints = data.discussionPoints || data.questions || data.discussion || [];
    
    console.log('[DEBUG] Discussion points:', discussionPoints);
    
    if (Array.isArray(discussionPoints) && discussionPoints.length > 0) {
        discussionPoints.forEach(point => {
            const li = document.createElement('li');
            
            // Handle different point formats
            if (typeof point === 'string') {
                li.textContent = point;
            } else if (point && point.text) {
                li.textContent = point.text;
            } else if (point && point.question) {
                li.textContent = point.question;
            } else {
                li.textContent = 'Discussion point';
            }
            
            discussionContainer.appendChild(li);
        });
    } else {
        // Simple fallback
        const fallbackPoints = [
            'How would you handle this situation as a team?',
            'What are the key risks and how can they be mitigated?',
            'What processes or procedures should be followed?',
            'How should you communicate with stakeholders?',
            'What follow-up actions are necessary?'
        ];
        
        fallbackPoints.forEach(point => {
            const li = document.createElement('li');
            li.textContent = point;
            discussionContainer.appendChild(li);
        });
    }
    
    // Show scenario output
    document.getElementById('scenarioOutput').style.display = 'block';
    
    // Scroll to scenario
    document.getElementById('scenarioOutput').scrollIntoView({ 
        behavior: 'smooth',
        block: 'start' 
    });
}

function displayErrorFallback() {
    const dept = departments.find(d => d.id === selectedDepartment);
    document.getElementById('scenarioIcon').textContent = dept.icon;
    document.getElementById('scenarioTitle').textContent = 'No Scenarios Available';
    document.getElementById('scenarioDepartment').textContent = `${dept.name} Department`;
    document.getElementById('scenarioContent').textContent = 'No scenarios are available for this department in the offline template. Please select a different department or contact your administrator to add more scenarios.';
    const discussionContainer = document.getElementById('discussionPoints');
    discussionContainer.innerHTML = '<li>Try a different department</li><li>Contact your administrator to add more scenarios</li>';
    document.getElementById('scenarioOutput').style.display = 'block';
    document.getElementById('scenarioOutput').scrollIntoView({ behavior: 'smooth' });
}

// Initialize everything when page loads
document.addEventListener('DOMContentLoaded', function() {
    console.log('[DEBUG] Page loaded, initializing...');
    
    createDepartmentCards();
    setupComplexitySelector();
    
    // Add click handler to generate button
    document.getElementById('generateBtn').addEventListener('click', generateScenario);
    
    updateStatus('Ready to generate scenarios');
    console.log('[DEBUG] Initialization complete');
});
    </script>
    <script src="/js/theme.js"></script>
    </body>
</html>